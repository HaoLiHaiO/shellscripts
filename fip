#!/usr/bin/env bash

# Check for mpc
APP=$(which mpc)
[ ! -x "$APP" ] && echo "Can't find mpc." >&2 && exit 1

# Use cmdline parameter or MPD_HOST variable or "black"
HOST=${1:-$MPD_HOST}
HOST=${HOST:-black}

THISHOST=$(uname -n)
[ "$HOST" = "$THISHOST" -o "$HOST" = "me" -o "$HOST" = "this" ] && HOST=localhost
[ "$HOST" != "localhost" ] && echo -n "Host '$HOST' "

# Fip stream URL
FIP='http://chai5she.cdn.dvmr.fr/fip-midfi.mp3'

# Save current track, stop playing
CUR=$($APP -h "$HOST" -f "%file%" current)
[ -n "$CUR" ] && $APP -h "$HOST" stop &> /dev/null

echo -n 'Fip Radio '

# Start Fip if it wasn't playing before
if [ "$CUR" = "$FIP" ]; then
	echo 'off'
else
    $APP -h "$HOST" clear &> /dev/null
    $APP -h "$HOST" add "$FIP" &> /dev/null
    $APP -h "$HOST" play &> /dev/null
    # Display volume
    $APP -h "$HOST" volume
fi
exit 0
